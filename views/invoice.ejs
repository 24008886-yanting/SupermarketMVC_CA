<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Invoice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .invoice-box {
            padding: 30px;
            border: 1px solid #eee;
            border-radius: 10px;
            background-color: #f9f9f9;
        }

        .invoice-header {
            margin-bottom: 20px;
        }

        .invoice-footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            color: #555;
        }
    </style>
</head>

<body>
    <%- include('partials/navbar') %>

        <div class="container my-5 invoice-box">
            <div class="invoice-header d-flex justify-content-between">
                <div>
                    <h2>Groovy Market</h2>
                    <p>123 Market Street, Singapore<br>Email: groovy_market@rp.com<br>Tel: 6800 8900</p>
                </div>
                <div class="text-end">
                    <h4>Invoice</h4>
                    <p>
                        Order #: <%= order.order_id %><br>
                            Date: <%= new Date(order.created_at).toLocaleDateString() %>
                    </p>
                </div>
            </div>

            <div class="mb-4">
                <h5>Customer:</h5>
                <p>
                    <%= user ? user.username : 'Guest' %><br>
                        Email: <%= user && user.email ? user.email : 'N/A' %>
                </p>
            </div>

            <table class="table table-bordered">
                <thead class="table-secondary">
                    <tr>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <% let total=0; %>
                        <% items.forEach(item=> { %>
                            <tr>
                                <td>
                                    <%= item.product_name %>
                                </td>
                                <td>
                                    <%= item.quantity %>
                                </td>
                                <td>$<%= item.price.toFixed(2) %>
                                </td>
                                <td>$<%= (item.price * item.quantity).toFixed(2) %>
                                </td>
                            </tr>
                            <% total +=item.price * item.quantity; %>
                                <% }) %>
                </tbody>
                <tfoot>
                    <%
                        const summary = orderSummary || {};
                        const threshold = typeof shippingThreshold === 'number' ? shippingThreshold : 60;
                        const baseShipping = typeof shippingBaseFee === 'number' ? shippingBaseFee : 5.9;
                        const subtotal = typeof summary.subtotal === 'number' ? summary.subtotal : total;
                        const shippingFee = typeof summary.shippingFee === 'number' ? summary.shippingFee : ((subtotal > 0 && subtotal < threshold) ? baseShipping : 0);
                        const finalTotal = typeof summary.total === 'number' ? summary.total : subtotal + shippingFee;
                    %>
                    <tr>
                        <th colspan="3" class="text-end">Subtotal</th>
                        <th>$<%= subtotal.toFixed(2) %></th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">Shipping</th>
                        <th>
                            <% if (shippingFee === 0) { %>
                                <span class="text-success">Free</span>
                            <% } else { %>
                                $<%= shippingFee.toFixed(2) %>
                            <% } %>
                        </th>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-end">Total</th>
                        <th>$<%= finalTotal.toFixed(2) %></th>
                    </tr>
                </tfoot>
            </table>

            <div class="d-flex justify-content-between mt-4">
                <a href="/shopping" class="btn btn-secondary">Back to Shopping</a>
            </div>


        </div>
</body>

</html>

